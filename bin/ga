#!/usr/bin/env ruby

require 'ga/cli'
require 'gli'

include GLI::App

program_desc 'Google Analytics'

flag [:authfile], :default_value => File.join(ENV['HOME'],'.ga.auth.yaml')


desc 'Checks authentication file'
command :check do |c|
  c.action do |global,opts,args|
    unless File.exists? global[:authfile]
      GA::Cli::AUTH.verification_information.tap do |info|
        authenticator = GA::Authenticator.new(info,GA::Cli::AUTH)
        STDERR.puts authenticator.directions
        auth = authenticator.listen_for_auth
        File.open(global[:authfile], 'w'){ |f| f.puts auth.to_yaml }
      end
    end
  end
end

exit run(ARGV)
    
